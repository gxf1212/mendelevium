# 图片处理规范

## 图片数量

### 主文档
- **最少**：4张图
- **最多**：8张图
- **推荐**：5-6张图

### 附录
- 不限数量
- 放置主文档放不下的图

---

## 图片插入格式

### 标准格式

```markdown
![fig1](文章文件夹/fig1.png)

**图1：[完整的图标题中文翻译]**
- **图1A**：[子图A的详细描述]
- **图1B**：[子图B的详细描述]
- **颜色说明**：蓝色代表xxx，红色代表xxx，绿色代表xxx

[紧接着的讲解段落，解读这张图的关键发现，50-100字]
```

### 位置要求

- 图片在图注**上方**
- 图注在讲解段落**上方**
- 顺序：图片 → 图注 → 讲解

---

## 图注要求

### 必须包含的内容

1. **图标题**：完整的中文翻译
2. **子图说明**：每个子图（A/B/C）的描述
3. **颜色说明**：所有颜色的含义

### 示例

**✅ 完整的图注**：
```markdown
**图1：PETase的晶体结构**
- **图1A**：PETase整体结构(PDB ID: 5XG0)，采用卡通表示，β-链为洋红色，α-螺旋为青色
- **图1B**：催化三联体的特写视图，标注了关键相互作用距离(Å)
- **颜色说明**：绿色表示催化残基，黄色表示二硫键，橙色表示Gly-X-Ser-X-Gly基序
```

**❌ 不完整的图注**：
```markdown
**图1：PETase结构**
```

---

## 图文融合

### 讲解段落要求

每张图**必须**有讲解段落：
- 50-100字
- 解读关键发现
- 不简单重复图注

### 示例

```markdown
![fig1](petase_mechanism/fig1.png)

**图1：PETase的晶体结构**
- **图1A**：PETase整体结构，β-链为洋红色，α-螺旋为青色
- **图1B**：催化三联体的特写视图
- **颜色说明**：绿色表示催化残基，黄色表示二硫键

PETase采用典型的α/β-水解酶折叠，由9个β-链和7个α-螺旋组成。**催化三联体Ser131-His208-Asp177**位于活性位点中心，三个残基之间的距离为2.8-3.2 Å，形成了经典的氢键网络。两个二硫键（DS1和DS2）稳定了整体结构，其中DS1位于活性位点附近，对底物结合至关重要。
```

---

## 图片文件规范

### 文件命名

```
fig1.png
fig2.png
fig3.png
...
```

### 文件位置

```
_pages/<分类>/YYYY-MM-DD-<标题>/
├── fig1.png
├── fig2.png
└── fig3.png
```

### 图片格式

- **推荐**：PNG（无损压缩）
- **备选**：JPG（文件较大时）
- **分辨率**：至少300 DPI

---

## 提取图片

### 使用工具

```bash
# 自动模式（推荐）
python3 tools/extract_pdf_figures.py <pdf_path> <output_dir> --pages 3,5,6

# 指定Figure编号
python3 tools/extract_pdf_figures.py <pdf_path> <output_dir> --figures "1:3,2:5,3:6"
```

### ⚠️ 图注位置验证（关键原则）

**唯一判断标准**：图注文字必须与图片在**同一页面**

- 使用 `search_pdf_text.py` 找到图注所在的页码
  ```bash
  python3 tools/search_pdf_text.py paper.pdf "Figure 1." 3
  python3 tools/search_pdf_text.py paper.pdf "Scheme 1." 3
  ```
- 该页面的图片才是对应的Figure/Scheme
- **不要根据顺序或猜测来分配编号**

**特殊情况**：
- Figure和Scheme可能混排（如页面3有Figure 1和Scheme 3）
- 一个页面可能有多张图（如页面2有Scheme 1和Scheme 2）
- 如果某页有"Scheme X"的文字描述但**没有对应的大图**，说明不存在该Scheme的图片

**验证工具**（可选辅助）：
```bash
# 使用OCR验证图片内是否包含Scheme文字
python3 tools/verify_scheme_in_image.py paper.pdf
```

### 选择标准

**优先选择**：
1. 最能说明核心方法的图
2. 最关键的结果图
3. 最有说服力的对比图

**避免选择**：
1. 过于复杂的SI图
2. 重复信息的图
3. 次要的补充数据图
4. **原文不存在的图片**（如错误编号的Figure 7, 8, 9等）

---

## 图片顺序

### 基本原则

- 按文章逻辑顺序出现
- Figure 1通常是方法流程图或总体结构图
- 最后的Figure通常是总结图或应用图

### 示例顺序

1. **图1**：方法流程图或整体框架
2. **图2-3**：核心方法的技术细节
3. **图4-6**：主要结果
4. **图7**：方法对比或消融实验
5. **图8**：应用场景或总结图

---

## 检查清单

### 基本检查

- [ ] 主文档有4-8张图
- [ ] 每张图都有完整图注（标题+子图+颜色）
- [ ] 每张图都有讲解段落
- [ ] 图片路径正确（相对路径）
- [ ] 图片按顺序出现
- [ ] 图片清晰（至少300 DPI）
- [ ] 无重复图表编号

---

## 🔍 最终验证步骤（必须执行）

**写完文档后，必须逐一确认所有图片：**

### 步骤1：自动化验证工具

```bash
# 验证所有图片编号、文件和图注
python3 tools/verify_blog_figures.py <主文档.md>
python3 tools/verify_blog_figures.py <附录.md>  # 如有附录
```

**工具检查项**：
- ✓ 图片引用数量（提取所有 `![figX]` 和 `![schemeX]`）
- ✓ 文件是否存在（检查图片文件路径）
- ✓ 编号连续性（Figure 1, 2, 3... 和 Scheme 1, 2, 3...）
- ✓ 图注匹配（检查图注和图片引用是否一一对应）

### 步骤2：手动对照验证

**对照原文PDF，逐一确认：**

1. **编号正确性**
   - [ ] 对照原文PDF，验证每个Figure/Scheme的编号是否正确
   - [ ] 使用 `search_pdf_text.py` 确认图注在同一页面
   ```bash
   python3 tools/search_pdf_text.py paper.pdf "Figure 1." 3
   python3 tools/search_pdf_text.py paper.pdf "Scheme 1." 3
   ```

2. **内容一致性**
   - [ ] 检查提取的图片内容是否与原文图注描述一致
   - [ ] 确认没有提取错误的图片（如Figure和Scheme混淆）
   - [ ] 确认没有遗漏重要图片

3. **图注准确性**
   - [ ] 验证文档中的图注中文翻译是否准确描述了图片内容
   - [ ] 检查子图说明（A/B/C）是否完整
   - [ ] 检查颜色说明是否完整

4. **文件完整性**
   - [ ] 使用grep检查所有图片引用
   ```bash
   grep -E "!\[fig|!\[scheme" <主文档.md>
   ```
   - [ ] 确认所有引用的文件都存在
   - [ ] 确认没有多余的图片文件

### 步骤3：常见错误检查

- [ ] **Scheme特殊性**：Scheme图注文字必须与图片在同一页
- [ ] **混排情况**：同一页可能有Figure和Scheme，需根据图注位置判断
- [ ] **不存在的图**：如原文只有文字描述但无大图，不要创建该图片
- [ ] **编号连续性**：Figure/Scheme各自编号应连续（1,2,3...）

### ✅ 验证通过标准

- ✅ `verify_blog_figures.py` 无错误
- ✅ 所有图片编号与原文一致
- ✅ 所有图片文件存在且内容正确
- ✅ 所有图注完整准确
